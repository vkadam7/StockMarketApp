<!--Stock Display page by Ian Mcnulty-->
<!DOCTYPE html>
<html>
    <head>
        <link rel = "stylesheet" href = "/static/stylesheets/styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    </head>
    <header>
        {% if session['user'] %}
        <div class = "login">
            <p>Hello {{person}} <a method = "POST" href = "logout">Logout</a></p>
        </div>
        {% else %}
        <div class = "login">
            <p><a method = "POST" href = "login">Login</a> or <a method = "POST" href = "register">Register</a></p>
        </div>
        {% endif %}
        <!--Navbar by Muneeb Khan-->
        <div class = "navbar">
            <nav>
                <ul>
                    <li><a method = "POST" href = "home">Home</a></li>
                    <li><a method = "POST" href = "aboutus">About Us</a></li>
                    <li><a method = "POST" href = "information">Information</a></li>
                    <li class="stockSimStartButton">
                        <form id="stockSimStart" action="/stockSimForm" method="post">
                            <button>Start a simulation!</button>
                        </form>
                        <script type="text/javascript">
                            if ({{ session['loginFlagPy'] }} == 0 || {{ session['Simulation'] }} != null ) 
                                document.getElementById('stockSimStart').style.display = "none";
                        </script>
                    </li>
                </ul>
            </nav>
            <form action="/stockSearch" method="post">
                <input class = "stockSearchBar" type="search" name="searchTerm" placeholder="Find a stock..."
                        value="{{ request.form['searchTerm'] }}">
                <button class = "stockSearchButton" type = "button">Search</button>
            </form>
        </div>
    </header>
    <body>
        <div class="stockDisplay">
            <h1>{{ stock['ticker'] }} - {{ stock['name'] }}</h1>
            <h3>Headquarters: {{ stock['headquarters'] }}</h3>
            <h3>Listed at: {{ stock['listedAt'] }}</h3>
            <canvas id="stockChart" width="900" height="400"></canvas>
            <script>
                var ctx = document.getElementById("stockChart").getContext("2d");
                var stockChart = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: {{ dates | safe }},
                        datasets: [{
                            label: "Stock values",
                            data: {{ avgs | safe }},
                            fill: false,
                            borderColor: "rgb(20, 100, 200)",
                            lineTension: 0
                        }]
                    },
                    options: {
                        display: true
                    }
                });
            </script>
        </div>        
        <form action="/changeView" method="post">
            <div class="stockUtilityBar">
                <div class="stockUtilityBarIcon">
                    <h3>Starting Date:</h3>
                    <input type="date" name="startDate" placeholder="yyyy-mm-dd" 
                        value="{{ request.form['startDate'] }}">
                </div>
                <div class="stockUtilityBarIcon">
                    <h3>Ending Date:</h3>
                    <input type="date" name="endDate" placeholder="yyyy-mm-dd"
                        value="{{ request.form['endDate'] }}">
                </div>
                <div class="stockUtilityBarIcon">
                    <h3>Timespan:</h3>
                    <select name="timespan" value="{{ request.form['timespan'] }}">
                        <option value="hourly">Hourly prices</option>
                        <option value="daily">Daily prices</option>
                        <option value="weekly">Weekly prices</option>
                        <option value="monthly">Monthly prices</option>
                    </select>
                </div>
                <div class="stockUtilityBarIcon">
                    <button type="submit">Show Range</button>
                </div>
                <!--Author: Viraj
                Buy sell features for the stock market simulator, will place here for now until plan for game is confirmed. Buttons will
                only appear if user if logged in-->
               
            </div>
        </form>
        <form id='buySellButtons' action="/orderForm" method="post">
            <div class="buySellButtons">
                <button type = "submit" name="option" value="{{ request.form['option'] }}">Buy</button>
                <button type = "submit" name="option" value="{{ request.form['option'] }}">Sell</button>
                <script>
                    var Display = $('.login').css.('display','block'):
                    var noDisplay = $('.login').css.('display', 'none'): 
                    if($('.notloggedin').css.('display') == 'none'){
                        $(Display);
                    }
                    else
                        $(noDisplay);               
                </script>    
            </div>
        </form>  
        <script type="text/javascript">
            if ({{ session['simulationFlag'] }} == False) 
                document.getElementById('buySellButtons').style.display = "none";
        /script>
    </body>
</html>